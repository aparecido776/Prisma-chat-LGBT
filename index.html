<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>PRISMA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
 --bg:#fff; --text:#000; --card:#f2f2f2;
}
.dark{
 --bg:#121212; --text:#fff; --card:#1e1e1e;
}
body{
 margin:0;font-family:Arial;background:var(--bg);color:var(--text);
}
header{
 background:linear-gradient(135deg,#ff0080,#7928ca,#00c6ff);
 color:white;padding:10px;text-align:center;font-size:20px;
}
#login,#chat{padding:15px;}
input,select{
 width:100%;padding:10px;margin-top:8px;border-radius:10px;border:1px solid #ccc;
}
button{
 padding:8px 12px;border:none;border-radius:10px;
 background:#7928ca;color:white;margin-top:8px;
}
#messages{
 height:300px;overflow-y:auto;margin-top:10px;
}
.msg{
 background:var(--card);padding:8px;border-radius:12px;margin-bottom:8px;
}
.user{font-weight:bold;color:#ff0080;}
img.avatar{width:30px;height:30px;border-radius:50%;vertical-align:middle;}
.top{
 display:flex;justify-content:space-between;align-items:center;
}
.small{font-size:12px;color:gray;}
</style>
</head>

<body>
<header>ğŸ³ï¸â€ğŸŒˆ PRISMA</header>

<div id="login">
<h3>Entrar</h3>
<input id="username" placeholder="Seu apelido">
<input type="file" id="photo">
<select id="room">
<option value="geral">Geral</option>
<option value="amizade">Amizade</option>
<option value="relacionamento">Relacionamento</option>
<option value="trans">Trans</option>
</select>
<button onclick="enterChat()">Entrar</button>
<p class="small">EspaÃ§o seguro e respeitoso ğŸ’–</p>
</div>

<div id="chat" style="display:none;">
<div class="top">
<select id="roomSelect">
<option value="geral">Geral</option>
<option value="amizade">Amizade</option>
<option value="relacionamento">Relacionamento</option>
<option value="trans">Trans</option>
</select>
<button onclick="toggleDark()">ğŸŒ™</button>
</div>

<div id="messages"></div>
<input id="messageInput" placeholder="Mensagem...">
<button onclick="sendMessage()">Enviar</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey:"SUA_API_KEY",
 authDomain:"SEU_DOMINIO",
 projectId:"SEU_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let user="", photoURL="", room="geral";
let blocked=[];

window.enterChat = async function(){
 user = username.value;
 room = roomSelect.value;
 const file = photo.files[0];
 if(!user) return alert("Digite seu nome");

 if(file){
   const reader = new FileReader();
   reader.onload = ()=>{ photoURL = reader.result; startChat(); };
   reader.readAsDataURL(file);
 } else {
   photoURL="";
   startChat();
 }
}

function startChat(){
 login.style.display="none";
 chat.style.display="block";
 loadMessages();
}

roomSelect.addEventListener("change",()=>{
 room = roomSelect.value;
 loadMessages();
});

function loadMessages(){
 const q = query(collection(db,room),orderBy("time"));
 onSnapshot(q,snap=>{
   messages.innerHTML="";
   snap.forEach(doc=>{
     const d=doc.data();
     if(blocked.includes(d.user)) return;
     messages.innerHTML+=`
     <div class="msg">
      ${d.photo?`<img src="${d.photo}" class="avatar">`:``}
      <span class="user">${d.user}</span>: ${d.text}<br>
      <button onclick="reportUser('${d.user}','${d.text}')">ğŸš¨</button>
      <button onclick="blockUser('${d.user}')">â›”</button>
     </div>`;
   });
   messages.scrollTop=messages.scrollHeight;
 });
}

window.sendMessage = async function(){
 if(!messageInput.value) return;
 await addDoc(collection(db,room),{
  user:user,
  photo:photoURL,
  text:messageInput.value,
  time:new Date()
 });
 messageInput.value="";
}

window.reportUser = async function(userR,text){
 await addDoc(collection(db,"reports"),{
  reported:userR,
  text:text,
  time:new Date()
 });
 alert("DenÃºncia enviada ğŸ’–");
}

window.blockUser = function(u){
 blocked.push(u);
 alert("UsuÃ¡rio bloqueado");
}

window.toggleDark = function(){
 document.body.classList.toggle("dark");
}
</script>
</body>
</html>